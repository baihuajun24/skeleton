<html>

    <head>
        <script data-require="jquery@*" data-semver="3.1.1" type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <title>hb364A3</title>
    </head>
    <body>
        <h1> F-word CSS</h1>
        <div id="container" style="width:40%; margin: auto">
        <div class='title'>My receipts</div>
        <div id="add-receipt">add</div>
        <div id="myDropdown" class="dropdown-content ">
            <input id="merchant" placeholder="Merchant"></input>
            <input id="amount" placeholder="Amount"></input>
            <button id="cancel-receipt">Cancel</button>
            <button id="save-receipt">Save</button>
        </div>
        <div id="receiptList">
                <div>Time</div>
                <div>Merchant</div>
                <div>$</div>
                <div>Tags</div>
        </div>
        </div>
    </body>
    <script>
    const api = ""
    function createContent(receipt) {
        var template = '<div class="receipt" id="'+receipt.id+'">';
        template += '<div class = "created">'+receipt.created+'</div>';
        template += '<div class="merchant">'+ receipt.merchantName +'</div>';
        template += '<div class="amount">'+ receipt.value +'</div>';
        template += '<div class="tags">&nbsp' +
            '<button class="add-tag" onclick="addtag(this)">Add +</button></div>';
        return template;
    }

    function addReceipt(merchant, amount) {
        var receipt = {"merchant":merchant,"amount":amount};
        $.ajax({
            type: "POST",
            data :JSON.stringify(receipt),
            url: "/receipts",
            contentType: "application/json"
        }).done(function (data) {
            $.getJSON("/receipts", function(receipts){
                $(createContent(receipts[receipts.length-1])).appendTo($("#receiptList"));
            })
        });
    }
    function addtag(btn) {
        var temp = '<input type="text" class="tag_input" placeholder="tag name"></div>';
        switch($(btn).siblings().is("input")) {
            case true:
                $(btn).siblings()[0].remove();
                break;
            case false:
                $(btn).after(temp);
                break;
        }
    }

    function removeTag(ele) {
        var receiptID = $(ele).parent().parent()[0].id;
        $.ajax({
            type: "PUT",
            data :JSON.stringify(receiptID),
            url: "/tags/"+$(ele).text(),
            contentType: "application/json"
        }).done(function (data) {
            $(ele).remove();
        });

    }

    $(document).on("keydown", ".tag_input", function(event) {
        if(event.keyCode == 13) {
            var receiptID = $(this).parent().parent()[0].id;
            var temp = '<button class="tagValue" onclick="removeTag(this)">'+ this.value +'</button>';
            $(this).before(temp);

            $.ajax({
                type: "PUT",
                data :JSON.stringify(receiptID),
                url: testapi+"/tags/"+tagName,
                contentType: "application/json"
            }).done(function (data) {
                $(event.target).val('');
                $(event.target).remove();
            });

        };

    })

    $("#add-receipt").click(function(){
    });
    $ ("#cancel-receipt").click(function(){
    });
    $('#save-receipt').click(function(){
        addReceipt($("#merchant").val(), $("#amount").val());
        $ ("#merchant").val('');
        $ ("#amount").val('');
    });
    </script>


</html>